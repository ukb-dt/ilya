<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ilya Triad vs Pyromancer Triad</title>
  <style>
    :root {
      --bg: #0b0b10;
      --card: #12131a;
      --soft: #1a1b24;
      --text: #e7e8ef;
      --muted: #a8adbd;
      --accent: #7aa2ff;
      --grid: rgba(255,255,255,0.06);
      --ok: #5dd39e;
      --warn: #ffd166;
      --note: #c792ea;
    }
    html,body{height:100%}
    body{
      margin:0; background: radial-gradient(1200px 800px at 75% -10%, #1a1d2b 0, #0b0b10 60%);
      color:var(--text); font: 16px/1.5 Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }
    .wrap{max-width:1100px;margin:0 auto;padding:28px}
    header{display:grid;grid-template-columns: 1fr 2fr;gap:24px;align-items:center}
    .lead{
      background:var(--card);border:1px solid var(--grid);border-radius:16px;overflow:hidden;position:relative;
    }
    .lead img{width:100%;height:auto;display:block}
    .lead .hint{position:absolute;bottom:8px;right:10px;font-size:12px;color:var(--muted);background:rgba(0,0,0,0.4);padding:4px 8px;border-radius:8px}
    .title h1{margin:0 0 8px;font-weight:800;letter-spacing:0.2px}
    .title p{margin:0;color:var(--muted)}
    .tools{margin-top:10px;display:flex;gap:8px;flex-wrap:wrap}
    button, .filelabel{background:var(--soft);border:1px solid var(--grid);color:var(--text);padding:8px 10px;border-radius:10px;cursor:pointer}
    button:hover,.filelabel:hover{border-color:#2a2d3f}
    .grid{margin-top:28px; background:var(--card); border:1px solid var(--grid); border-radius:16px; overflow:hidden}
    table{width:100%; border-collapse:collapse}
    thead th{background:linear-gradient(180deg, #1a1d2b, #141722); text-align:left; padding:14px 16px; font-size:13px; text-transform:uppercase; letter-spacing:0.08em; color:var(--muted); border-bottom:1px solid var(--grid)}
    tbody td{padding:14px 16px; border-top:1px solid var(--grid); vertical-align:top}
    tbody tr:hover td{background:rgba(255,255,255,0.02)}
    .tag{display:inline-block; padding:2px 8px; border-radius:999px; border:1px solid var(--grid); font-size:12px; color:var(--muted)}
    .ok{color:var(--ok)}
    .warn{color:var(--warn)}
    .note{color:var(--note)}
    .cols{display:grid;grid-template-columns:1fr 1fr;gap:18px;margin-top:24px}
    .card{background:var(--card);border:1px solid var(--grid);border-radius:14px;padding:16px}
    h2{margin:0 0 6px}
    h3{margin:0 0 8px}
    .small{font-size:13px;color:var(--muted)}
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}
    .foot{margin:28px 0 8px;color:var(--muted);font-size:12px;text-align:center}
    .kbd{border:1px solid var(--grid);background:#0f1017;padding:1px 6px;border-radius:6px}
    
    /* PDF Viewer Styles */
    .pdf-section{margin-top:28px}
    .pdf-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
    .pdf-controls{display:flex;gap:8px}
    .pdf-viewer{
      background:var(--card);border:1px solid var(--grid);border-radius:16px;overflow:hidden;
      height:600px;position:relative;
    }
    .pdf-iframe{width:100%;height:100%;border:none;border-radius:16px}
    .pdf-fallback{
      padding:40px;text-align:center;color:var(--muted);
      display:flex;flex-direction:column;align-items:center;gap:16px;
    }
    .pdf-placeholder{
      width:100%;height:100%;display:flex;align-items:center;justify-content:center;
      background:linear-gradient(135deg, var(--soft) 0%, var(--card) 100%);
      border-radius:16px;position:relative;overflow:hidden;
    }
    .pdf-placeholder::before{
      content:'';position:absolute;inset:0;
      background:url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.02'%3E%3Ccircle cx='30' cy='30' r='4'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E") repeat;
    }
    .pdf-content{position:relative;z-index:1;max-width:400px}
    .tab-container{margin-top:28px}
    .tab-buttons{display:flex;border-bottom:1px solid var(--grid);margin-bottom:16px}
    .tab-btn{
      background:none;border:none;color:var(--muted);padding:12px 20px;cursor:pointer;
      border-bottom:2px solid transparent;transition:all 0.2s ease;
    }
    .tab-btn:hover{color:var(--text)}
    .tab-btn.active{color:var(--accent);border-bottom-color:var(--accent)}
    .tab-content{display:none}
    .tab-content.active{display:block}
    .pdf-canvas{width:100%;height:100%;border:none;background:#fefefe}
    .pdf-page{margin-bottom:10px;box-shadow:0 2px 8px rgba(0,0,0,0.3)}
    .pdf-nav{position:absolute;top:10px;right:10px;display:flex;gap:8px;z-index:10}
    .pdf-nav button{background:rgba(0,0,0,0.7);color:white;border:none;padding:6px 12px;border-radius:6px;cursor:pointer;font-size:12px}
    .pdf-nav button:hover{background:rgba(0,0,0,0.9)}
    .pdf-nav button:disabled{opacity:0.5;cursor:not-allowed}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <figure class="lead">
        <img id="leadImage" src="https://placehold.co/560x560/png?text=Ilya%20triad%20shirt" alt="Ilya Sutskever T-shirt: input → hidden → output" />
        <figcaption class="hint">Lead image: Ilya's triad — input ▸ hidden ▸ output</figcaption>
      </figure>
      <div class="title">
        <h1>Ilya's Triad vs Pyromancer's Triad</h1>
        <p>Three-layer net contrasted with the five-layer tree, collapsed to a Pyromancer <em>triad</em> for parity.</p>
        <div class="tools">
          <label class="filelabel" for="fileInput">Upload lead image</label>
          <input id="fileInput" type="file" accept="image/*" style="display:none" />
          <button id="pasteUrl">img/ilya.jpeg</button>
        </div>
        <p class="small">Pyromancer triad used below: <strong>Ecosystem → Trunk (hidden, Σ) → Canopy/Fruit</strong>. (Roots and Branches appear as <em>recovered structure</em>.)</p>
      </div>
    </header>

    <div class="tab-container">
      <div class="tab-buttons">
        <button class="tab-btn active" data-tab="comparison">Comparison Table</button>
        <button class="tab-btn" data-tab="pdf">Fractal Aging PDF</button>
      </div>

      <div id="comparison" class="tab-content active">
        <section class="grid" aria-label="Comparison table">
          <table>
            <thead>
              <tr>
                <th style="width:18%">Ilya's Triad</th>
                <th style="width:22%">Pyromancer's Triad</th>
                <th style="width:22%">What You Recover (hidden structure)</th>
                <th style="width:20%">Training / Energy Implications</th>
                <th style="width:18%">Notes & Comments</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><strong>Input</strong>
                  <div class="small">Observed data; assumed given.</div>
                </td>
                <td><strong>Ecosystem</strong>
                  <div class="small">Arena & climate: where inputs are born.</div>
                </td>
                <td>
                  <span class="tag">Fractal Roots</span>
                  <div class="small">Sub-tendrils that source and pre-shape inputs; mirrors branches.</div>
                </td>
                <td>
                  <ul class="small">
                    <li>Data isn't free: model "data provenance energy".</li>
                    <li>Curriculum = staged climates (temperature, shocks).</li>
                  </ul>
                </td>
                <td class="small">
                  Nets flatten provenance; your triad restores the <em>surround</em>.
                </td>
              </tr>
              <tr>
                <td><strong>Hidden</strong>
                  <div class="small">Compression / representation.</div>
                </td>
                <td><strong>Trunk (Σ)</strong>
                  <div class="small">Architectural hidden layer; information bottleneck; integrity node.</div>
                </td>
                <td>
                  <span class="tag">Integrity @ Σ</span>
                  <div class="small">Prunes adversarial variance; preserves diagonal flow.</div>
                </td>
                <td>
                  <ul class="small">
                    <li>Regularize for <span class="note">fractal complexity</span>, not mere smoothness.</li>
                    <li>Energy view: costed compression → measure <em>reserve</em>.</li>
                  </ul>
                </td>
                <td class="small">
                  Trunk = hidden in the <em>architectural</em> sense (black box transformation).
                </td>
              </tr>
              <tr>
                <td><strong>Output</strong>
                  <div class="small">Predictions / surface.</div>
                </td>
                <td><strong>Canopy / Fruit</strong>
                  <div class="small">Ledger (ΔS) + Recursion (θ′): what persists and seeds next cycles.</div>
                </td>
                <td>
                  <span class="tag">Fractal Branching</span>
                  <div class="small">Expressive spread from trunk to leaves; mirrors roots.</div>
                </td>
                <td>
                  <ul class="small">
                    <li>Train for <span class="ok">resilience/elasticity</span>, not only accuracy.</li>
                    <li>Energy of recovery: post-hit delta (before vs after) as a KPI.</li>
                  </ul>
                </td>
                <td class="small">
                  Add a <em>fruit channel</em> for posterior updates (forks, policies, myths).
                </td>
                </tr>
            </tbody>
          </table>
        </section>

        <div class="cols">
          <section class="card">
            <h2>Recovery: What Your Triad Restores</h2>
            <ul>
              <li><strong>Ecosystem</strong> — returns provenance, climate, and curriculum to ontology.</li>
              <li><strong>Fractal Roots & Branching</strong> — restore hidden symmetry (below ↔ above).</li>
              <li><strong>Canopy/Fruit split</strong> — separates survival ledger (ΔS) from recursion (θ′).</li>
              <li><strong>Reserve as first-class metric</strong> — measure capacity to absorb hits and rebound.</li>
            </ul>
            <p class="small">Canonical line: <span class="mono">nets flatten the tree; your triad re-inflates the ecosystem and fruit.</span></p>
          </section>

          <section class="card">
            <h2>Training & Energy Implications</h2>
            <ol>
              <li><strong>Curriculum as Climate</strong> — vary shocks (temperature, scarcity) to test adaptation.</li>
              <li><strong>Bottleneck Integrity</strong> — regularizers that preserve multi-scale variability (avoid "over-smoothing").</li>
              <li><strong>Δ-Reserve</strong> — define <em>functional reserve</em> = performance margin before collapse; track after each perturbation.</li>
              <li><strong>Recovery KPI</strong> — <span class="mono">delta_after_hit = score(t₊) − score(t₋)</span>; optimize rebound dynamics, not just peak accuracy.</li>
              <li><strong>Fruit Loop</strong> — explicitly model θ′ updates (policies/forks) as outputs fed back into θ.</li>
            </ol>
          </section>
        </div>

        <section class="card" style="margin-top:18px">
          <h2>Notes & Comments</h2>
          <ul>
            <li>Ilya's shirt = minimal net: input → hidden → output. Your triad = minimal tree: ecosystem → trunk → canopy/fruit, with recovered symmetry (roots/branches).</li>
            <li>Use the <strong>stomp loop</strong> (16th-note arrival) as a live probe of reserve and recovery in the twin.</li>
            <li>Ledger vs Order of Rank: make ΔS two-layered (metrics + value hierarchy) to avoid actuarial leakage.</li>
            <li>Map each repo directory → ontology node; commit history → ΔS; forks → θ′.</li>
          </ul>
        </section>
      </div>

      <div id="pdf" class="tab-content">
        <section class="pdf-section">
          <div class="pdf-header">
            <h2>Fractal Aging Mathematical Framework</h2>
            <div class="pdf-controls">
              <label class="filelabel" for="pdfFileInput">Upload PDF</label>
              <input id="pdfFileInput" type="file" accept=".pdf" style="display:none" />
              <button onclick="loadPDF()">Load from URL</button>
              <button onclick="toggleFullscreen()">Fullscreen</button>
            </div>
          </div>
          
          <div class="pdf-viewer" id="pdfViewer">
            <div class="pdf-placeholder">
              <div class="pdf-content">
                <h3 style="color:var(--text);margin-bottom:16px">📄 Fractal Aging PDF Viewer</h3>
                <p>Upload a PDF file or click "Load from URL" to display the fractal-aging.pdf document.</p>
                <p class="small">This will show the detailed mathematical framework behind the Pyromancer triad concepts.</p>
                <div style="margin-top:20px">
                  <label class="filelabel" for="pdfFileInput2" style="background:var(--accent);border:none;color:white;padding:10px 20px;border-radius:8px;cursor:pointer;margin-right:12px">
                    📎 Upload PDF File
                  </label>
                  <input id="pdfFileInput2" type="file" accept=".pdf" style="display:none" />
                  <button onclick="loadPDF()" style="background:var(--soft);border:1px solid var(--grid);color:var(--text);padding:10px 20px;border-radius:8px;cursor:pointer">
                    🔗 Load from URL
                  </button>
                </div>
              </div>
            </div>
          </div>
          
          <div class="card" style="margin-top:16px">
            <h3>PDF Integration Notes</h3>
            <ul class="small">
              <li><strong>Mathematical Foundation:</strong> The PDF provides formal proofs and derivations for the fractal aging concepts.</li>
              <li><strong>Cross-Reference:</strong> Equations in the PDF directly support the "Training & Energy Implications" above.</li>
              <li><strong>Implementation:</strong> Use the PDF's algorithms to implement the Δ-Reserve and recovery KPI metrics.</li>
              <li><strong>Theoretical Bridge:</strong> Connects the intuitive triad comparison to rigorous mathematical treatment.</li>
            </ul>
          </div>
        </section>
      </div>
    </div>

    <p class="foot">Tip: click <span class="kbd">Upload lead image</span> or <span class="kbd">img/ilya.jpeg</span> to set Ilya's photo at top. Switch tabs to view the fractal aging PDF.</p>
  </div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script>
  const fileInput = document.getElementById('fileInput');
  const leadImage = document.getElementById('leadImage');
  const pasteBtn = document.getElementById('pasteUrl');
  const pdfFileInput = document.getElementById('pdfFileInput');
  const pdfFileInput2 = document.getElementById('pdfFileInput2');

  let currentPdf = null;
  let currentPage = 1;
  let totalPages = 0;

  fileInput.addEventListener('change', (e) => {
    const f = e.target.files?.[0];
    if (!f) return;
    const url = URL.createObjectURL(f);
    leadImage.src = url;
  });

  pasteBtn.addEventListener('click', async () => {
    const url = prompt('Paste an image URL for the lead image:');
    if (url) leadImage.src = url.trim();
  });

  // PDF file upload handlers
  pdfFileInput.addEventListener('change', handlePDFUpload);
  pdfFileInput2.addEventListener('change', handlePDFUpload);

  async function handlePDFUpload(e) {
    const file = e.target.files?.[0];
    if (!file || file.type !== 'application/pdf') {
      alert('Please select a valid PDF file.');
      return;
    }

    try {
      const arrayBuffer = await file.arrayBuffer();
      await loadPDFFromBuffer(arrayBuffer);
    } catch (error) {
      console.error('Error loading PDF:', error);
      showPDFError('Failed to load PDF file.');
    }
  }

  async function loadPDFFromBuffer(arrayBuffer) {
    const viewer = document.getElementById('pdfViewer');
    viewer.innerHTML = '<div style="padding:20px;text-align:center;color:var(--text)">Loading PDF...</div>';

    try {
      pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
      
      const pdf = await pdfjsLib.getDocument({data: arrayBuffer}).promise;
      currentPdf = pdf;
      totalPages = pdf.numPages;
      currentPage = 1;

      await renderPDFViewer();
    } catch (error) {
      console.error('PDF.js error:', error);
      showPDFError('Error rendering PDF. The file may be corrupted or password-protected.');
    }
  }

  async function renderPDFViewer() {
    const viewer = document.getElementById('pdfViewer');
    viewer.innerHTML = `
      <div class="pdf-nav">
        <button onclick="prevPage()" ${currentPage <= 1 ? 'disabled' : ''}>← Prev</button>
        <span style="background:rgba(0,0,0,0.7);color:white;padding:6px 12px;border-radius:6px;font-size:12px">
          ${currentPage} / ${totalPages}
        </span>
        <button onclick="nextPage()" ${currentPage >= totalPages ? 'disabled' : ''}>Next →</button>
      </div>
      <canvas id="pdfCanvas" class="pdf-canvas"></canvas>
    `;

    await renderPage(currentPage);
  }

  async function renderPage(pageNum) {
    if (!currentPdf) return;

    const page = await currentPdf.getPage(pageNum);
    const canvas = document.getElementById('pdfCanvas');
    const ctx = canvas.getContext('2d');

    const viewport = page.getViewport({ scale: 1.5 });
    canvas.height = viewport.height;
    canvas.width = viewport.width;

    await page.render({
      canvasContext: ctx,
      viewport: viewport
    }).promise;
  }

  async function prevPage() {
    if (currentPage <= 1) return;
    currentPage--;
    await renderPDFViewer();
  }

  async function nextPage() {
    if (currentPage >= totalPages) return;
    currentPage++;
    await renderPDFViewer();
  }

  function showPDFError(message) {
    const viewer = document.getElementById('pdfViewer');
    viewer.innerHTML = `
      <div class="pdf-fallback">
        <h3>PDF Load Error</h3>
        <p>${message}</p>
        <button onclick="document.getElementById('pdfFileInput').click()" style="margin-top:12px">Try Another File</button>
      </div>
    `;
  }

  // Tab functionality
  document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const targetTab = btn.dataset.tab;
      
      // Update active button
      document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      
      // Update active content
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
      });
      document.getElementById(targetTab).classList.add('active');
    });
  });

  // PDF URL loading functionality
  function loadPDF() {
    const url = prompt('Enter PDF URL (default: pdf/fractal-aging.pdf):') || 'pdf/fractal-aging.pdf';
    if (!url) return;

    const viewer = document.getElementById('pdfViewer');
    const iframe = document.createElement('iframe');
    iframe.className = 'pdf-iframe';
    iframe.src = url.trim();
    iframe.title = 'Fractal Aging PDF';
    
    iframe.onerror = () => showPDFError('Could not load PDF from the provided URL.');
    
    viewer.innerHTML = '';
    viewer.appendChild(iframe);
  }

  function toggleFullscreen() {
    const viewer = document.getElementById('pdfViewer');
    if (viewer.requestFullscreen) {
      viewer.requestFullscreen();
    } else if (viewer.webkitRequestFullscreen) {
      viewer.webkitRequestFullscreen();
    } else if (viewer.msRequestFullscreen) {
      viewer.msRequestFullscreen();
    }
  }
</script>
</body>
</html>
